# HTTP 请求范围

> HTTP 协议范围请求允许服务器只发送 HTTP 消息的一部分到客户端。范围请求在传送大的媒体文件，或者与文件下载的断点续传功能搭配使用时非常有用。

## 检查服务端是否支持范围请求

可以通过发送一个 HEAD 请求，看响应中是否有`Accept-Ranges`响应头，若不为`none`则接受范围请求

## 从服务端请求特定的范围

若支持范围请求则可以使用`Range`首部生成请求，该首部指示服务器应该返回文件的那一或哪几部分

### 单一范围

以 curl 为例

```
curl uri -i -H "Range: bytes=0-1023"
```

> 服务器端会返回 206 Partial Content 的响应

### 多重范围

以 curl 为例

```
curl uri -i -H "Range: bytes=0-50, 100-150"
```

> 服务器返回 206 Partial Content 状态码，和 Content-Type: multipart/byteranges; boundary=....头部对 body 进行划分

### 条件式范围请求

The If-Range 请求首部可以用来生成条件式范围请求：假如条件满足的话，条件请求就会生效，服务器会返回状态码为 206 Partial 的响应，以及相应的消息主体。假如条件未能得到满足，那么就会返回状态码为 200 OK 的响应，同时返回整个资源。该首部可以与 Last-Modified 验证器或者 ETag 一起使用，但是二者不能同时使用。

## 范围请求的响应

- 成功返回 206 Partial Content 状态码
- 请求越界返回 416 Request Range Not Satisfiable 状态码
- 在条件范围请求失败或不支持范围请求的情况下返回 200 OK 状态码，并返回整个资源

## 与分块传输编码的对比

Transfer-Encoding 首部允许分块编码，这在数据量很大，并且在请求未能完全处理完成之前无法知晓响应的体积大小的情况下非常有用。服务器会直接把数据发送给客户端而无需进行缓冲或确定响应的精确大小——后者会增加延迟。范围请求与分块传输是兼容的，可以单独或搭配使用。
